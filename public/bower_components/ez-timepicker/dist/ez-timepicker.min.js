angular.module("ez.timepicker",["ui.bootstrap"]).constant("EzTimepickerConfig",{minuteStep:15,showMeridian:!0,meridians:["AM","PM"],inputClass:"form-control",inputContainerClass:"input-group",clockIconClass:"icon-time",widgetColClass:"col-xs-4",incIconClass:"icon-chevron-up",decIconClass:"icon-chevron-down"}).directive("ezTimepicker",["EzTimepickerConfig",function(a){return{restrict:"EA",replace:!0,transclude:"element",templateUrl:"ez-timepicker.html",scope:{time:"=ezTimepicker"},link:function(b,c,d){b.minuteStep=parseInt(d.minuteStep,10)||a.minuteStep,b.showMeridian=b.$eval(d.showMeridian)||a.showMeridian,b.meridians=d.meridians||a.meridians,b.inputClass=d.inputClass||a.inputClass,b.inputContainerClass=d.inputContainerClass||a.inputContainerClass,b.clockIconClass=d.clockIconClass||a.clockIconClass,b.widgetColClass=d.widgetColClass||a.widgetColClass,b.incIconClass=d.incIconClass||a.incIconClass,b.decIconClass=d.decIconClass||a.decIconClass,b.widget={},b.updateFromInput=function(){k(b.time)},b.preventDefault=function(a){a.preventDefault(),a.stopPropagation()},b.incrementHours=function(){b.showMeridian?11===b.widget.hours?(b.widget.hours++,b.toggleMeridian()):12===b.widget.hours?b.widget.hours=1:b.widget.hours++:23===b.widget.hours?b.widget.hours=0:b.widget.hours++},b.decrementHours=function(){b.widget.hours--,0===b.widget.hours?b.widget.hours=b.showMeridian?12:23:11===b.widget.hours&&b.showMeridian&&b.toggleMeridian()},b.incrementMinutes=function(){b.widget.minutes=parseInt(b.widget.minutes,10)+b.minuteStep,b.widget.minutes>=60&&(b.widget.minutes=0,b.incrementHours()),e()},b.decrementMinutes=function(){b.widget.minutes=b.widget.minutes-b.minuteStep,parseInt(b.widget.minutes,10)<0&&(b.decrementHours(),b.widget.minutes+=60),e()},b.toggleMeridian=function(){b.widget.meridian=b.widget.meridian===b.meridians[0]?b.meridians[1]:b.meridians[0]};var e=function(){parseInt(b.widget.minutes,10)>=60&&(b.widget.minutes=0,b.incrementHours()),parseInt(b.widget.minutes,10)<10&&(b.widget.minutes="0"+parseInt(b.widget.minutes,10))},f=function(){angular.isDefined(b.widget.hours)&&angular.isDefined(b.widget.minutes)?b.time=b.widget.hours+":"+b.widget.minutes+" "+b.widget.meridian:k(b.time)},g=function(a){a.originalEvent&&(a=a.originalEvent);var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0},h=function(a){b.$apply(g(a)?b.incrementHours():b.decrementHours()),a.preventDefault()},i=function(a){b.$apply(g(a)?b.incrementMinutes():b.decrementMinutes()),a.preventDefault()},j=function(a){b.$apply(b.toggleMeridian()),a.preventDefault()},k=function(a){var c,d,f,g;a?(b.widget.meridian=a.match(new RegExp(b.meridians[1].substring(0,1),"i"))?b.meridians[1]:b.meridians[0],c=a.replace(/[^0-9\:]/g,"").split(":"),f=c[0]?c[0].toString():c.toString(),g=c[1]?c[1].toString():"",f.length>2&&(g=f.substr(2,2),f=f.substr(0,2)),g.length>2&&(g=g.substr(0,2)),f=parseInt(f,10),g=parseInt(g,10),isNaN(f)&&(f=0),isNaN(g)&&(g=0)):(d=new Date,f=d.getHours(),g=d.getMinutes(),b.widget.meridian=b.showMeridian&&f>=12?b.meridians[1]:b.meridians[0]),b.showMeridian?0===f?b.widget.hours=12:f>12?(b.widget.hours=f-12,b.widget.meridian=b.meridians[1]):b.widget.hours=f:b.widget.hours=f,b.widget.minutes=Math.ceil(g/b.minuteStep)*b.minuteStep,e(),b.time=b.widget.hours+":"+b.widget.minutes+" "+b.widget.meridian};c.find(".hours-col").on("mousewheel wheel",h),c.find(".minutes-col").on("mousewheel wheel",i),c.find(".meridian-col").on("mousewheel wheel",j),b.$watch("widget",function(){f()},!0)}}}]);